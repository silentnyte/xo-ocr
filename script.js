var img_org = new Image(); // original image
// Based on ideal capital letter size of 30-34px
// https://groups.google.com/g/tesseract-ocr/c/Wdh_JJwnw94/m/24JHDYQbBQAJ
var ideal_iw = 1280;
var max_cw = 512;
var proportion = 1; // ratio of canvas size / original image
var title_color;

// const worker = Tesseract.createWorker({
//   logger: m => console.log(m)
// });
// Tesseract.setLogging(true);

var form = document.getElementById("form");
var ocr_info = document.getElementById("log");
var cnv0 = document.getElementById("cnv_org");
var ctx0 = cnv0.getContext("2d");
var cnv_ocr = document.getElementById("cnv_ocr");
var ctx_ocr = cnv_ocr.getContext("2d");

var cnv_org = document.createElement("canvas");
var ctx_org = cnv_org.getContext("2d");
var cnv_inv = document.createElement("canvas");
var ctx_inv = cnv_inv.getContext("2d");
var cnv_filter = document.createElement("canvas");
var ctx_filter = cnv_filter.getContext("2d");
var cnv_title = document.createElement("canvas");
var ctx_title = cnv_title.getContext("2d");

var iw, ih;
var cw = (cnv0.width = cnv_ocr.width = max_cw);
var ch = (cnv0.height = cnv_ocr.height = ~~(max_cw * 1.5));
ctx0.fillStyle = "#000000";
ctx0.font = "16px Courier";
ctx0.textAlign = "center";
ctx0.textBaseline = "middle";
ctx0.fillText("PASTE ITEM CLIP HERE", ~~(cw / 2), ~~(ch / 2));

var featureImgs = {
  feature_blast: new Image(),
  feature_bullet: new Image(),
  feature_fire: new Image(),
  feature_melee: new Image(),
  feature_passthrough: new Image(),
};
featureImgs.feature_blast.src =
  "data:image/png;base64,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";
featureImgs.feature_bullet.src =
  "data:image/png;base64,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";
featureImgs.feature_fire.src =
  "data:image/png;base64,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";
featureImgs.feature_melee.src =
  "data:image/png;base64,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";
featureImgs.feature_passthrough.src =
  "data:image/png;base64,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";

// Created by STRd6
// MIT License
// jquery.paste_image_reader.js
(function ($) {
  var defaults;
  $.event.fix = (function (originalFix) {
    return function (event) {
      event = originalFix.apply(this, arguments);
      if (
        event.type.indexOf("copy") === 0 ||
        event.type.indexOf("paste") === 0
      ) {
        event.clipboardData = event.originalEvent.clipboardData;
      }
      return event;
    };
  })($.event.fix);
  defaults = {
    callback: $.noop,
    matchType: /image.*/,
  };
  return ($.fn.pasteImageReader = function (options) {
    if (typeof options === "function") {
      options = {
        callback: options,
      };
    }
    options = $.extend({}, defaults, options);
    return this.each(function () {
      var $this, element;
      element = this;
      $this = $(this);
      return $this.bind("paste", function (event) {
        var clipboardData, found;
        found = false;
        clipboardData = event.clipboardData;
        return Array.prototype.forEach.call(
          clipboardData.types,
          function (type, i) {
            var file, reader;
            if (found) {
              return;
            }
            if (
              type.match(options.matchType) ||
              clipboardData.items[i].type.match(options.matchType)
            ) {
              file = clipboardData.items[i].getAsFile();
              reader = new FileReader();
              reader.onload = function (evt) {
                return options.callback.call(element, {
                  dataURL: evt.target.result,
                  event: evt,
                  file: file,
                  name: file.name,
                });
              };
              reader.readAsDataURL(file);
              return (found = true);
            }
          }
        );
      });
    });
  });
})(jQuery);

var dataURL, filename;
$("html").pasteImageReader(function (results) {
  filename = results.filename;
  dataURL = results.dataURL;
  $data.text(dataURL);
  $size.val(results.file.size);
  $type.val(results.file.type);
  img_org.src = dataURL;
  $width.val(img_org.width);
  $height.val(img_org.height);

  return (
    $(".active")
      //.css({backgroundImage: "url(" + dataURL + ")"})
      .data({ width: iw, height: ih })
  );
});

var $data, $size, $type, $width, $height;
$(function () {
  $data = $(".data");
  $size = $(".size");
  $type = $(".type");
  $width = $("#width");
  $height = $("#height");
  $(".target").on("click", function () {
    var $this = $(this);
    var bi = $this.css("background-image");
    if (bi != "none") {
      $data.text(bi.substr(4, bi.length - 6));
    }

    $(".active").removeClass("active");
    $this.addClass("active");
  });
});

var cimgs; // cropped images
function update_cimgs() {
  cimgs = {
    title: {
      sx: ~~(iw - iw * 0.83),
      sy: 0,
      sw: ~~(iw * 0.83),
      sh: ~~(iw * 0.18),
      dx: ~~((iw - iw * 0.83) * proportion),
      dy: 0,
      dw: ~~(iw * 0.83 * proportion),
      dh: ~~(iw * 0.18 * proportion),
    },
    body: {
      sx: 0,
      sy: ~~(iw * 0.2),
      sw: iw,
      sh: ~~(ih - iw * 0.2),
      dx: 0,
      dy: ~~(iw * 0.2 * proportion),
      dw: ~~(iw * proportion),
      dh: ~~((ih - iw * 0.2) * proportion),
      sx2: ~~(iw * 0.47),
      sw2: ~~(iw * 0.49),
      sh2: 8,
    },
    desc: {
      sx: 0,
      sy: ~~(iw * 0.2),
      sw: iw,
      sh: 0,
    },
    ps: {
      sx: 0,
      sy: 0,
      sw: iw,
      sh: 0,
    },
    stats: {
      sx: 0,
      sy: 0,
      sw: ~~(iw * 0.45),
      sh: 0,
      sx2: ~~(iw * 0.47),
      sw2: ~~(iw * 0.49),
      sh2: 8,
    },
    perks: {
      sx: ~~(iw * 0.1),
      sy: 0,
      sw: ~~(iw * 0.9),
      sh: 0,
    },
  };
}

var spellchk = [
  ["puwer", "power"],
  ["catlin", "cabin"],
  ["amrno", "ammo"],
  ["bverheating", "overheating"],
  ["Nut", "Not"],
  ["nut", "not"],
  ["Dues", "Does"],
  ["sturage", "storage"],
  ["Nunâ€™", "Non-"],
  ["Frame black", "Frame block"],
];

function drawOCR(scr, dst, cimg) {
  cimg.dx = ~~(cimg.sx * proportion);
  cimg.dy = ~~(cimg.sy * proportion);
  cimg.dw = ~~(cimg.sw * proportion);
  cimg.dh = ~~(cimg.sh * proportion);

  var cnv = document.getElementById(dst);
  var ctx = cnv.getContext("2d");
  ctx.drawImage(
    scr,
    cimg.sx,
    cimg.sy,
    cimg.sw,
    cimg.sh,
    cimg.dx,
    cimg.dy,
    cimg.dw,
    cimg.dh
  );
}

async function ocrImage() {
  await recognizeFile(cnv_title).then((data) => processTitleOCR(data));
  await recognizeFile(cnv_filter).then((data) => locatePS(data, cimgs.ps));
  if (cimgs.ps.sy > 0) {
    cimgs.desc.sh = cimgs.ps.sy - cimgs.desc.sy;
    await recognizeFile(
      ctx_inv.getImageData(
        cimgs.desc.sx,
        cimgs.desc.sy,
        cimgs.desc.sw,
        cimgs.desc.sh
      )
    ).then((data) => processDescOCR(data, cimgs.desc));

    cimgs.stats.sy = cimgs.ps.sy + cimgs.ps.sh;
    cimgs.stats.sh = ih - cimgs.stats.sy;
    await recognizeFile(
      ctx_inv.getImageData(
        cimgs.stats.sx,
        cimgs.stats.sy,
        cimgs.stats.sw,
        cimgs.stats.sh
      )
    ).then((data) => processStatsOCR(data, cimgs.stats));
    validate();
  } else {
    //TODO: Add error proccessing if PS not found
    alert('"POWER SCORE" not found in image!');
  }
}

function processTitleOCR(data) {
  var iname = "";
  var itype = "";
  for (let l in data.lines) {
    var txt = data.lines[l].text.trim();
    if (txt.length > 0) {
      for (let j = 0; j < spellchk.length; j++) {
        txt = txt.replace(spellchk[j][0], spellchk[j][1]);
      }
      if (iname == "") {
        iname = txt;
      } else {
        itype = txt;
      }
    }
  }
  document.getElementById("name").value = iname;
  document.getElementById("type").value = itype;

  var xoDB_query = encodeURIComponent(iname);
  var xoDB_url = "https://crossoutdb.com/api/v1/items?query=" + xoDB_query;
  getJSON(xoDB_url, function (err, json_data) {
    if (err != null) {
      console.error(err);
    } else {
      // console.log(json_data);
      if (typeof json_data[0] === "undefined") {
        // TODO: Add error proccessing
        addAlert('"' + iname + '" was not found in database.');
      } else {
        // var rarity = json_data[0].rarityName;
        var faction = "Shop";
        if (json_data[0].faction != null) {
          faction = json_data[0].faction;
        }
        var category = json_data[0].categoryName;
        // var type = json_data[0].typeName;
        var id = json_data[0].id;
        document.getElementById("category").value = category;
        document.getElementById("faction").value = faction;
        document.getElementById("id").value = id;
      }
    }
  });

  // var query = encodeURIComponent("SELECT * WHERE A='" + iname + "'");
  // var url =
  //   "https://docs.google.com/spreadsheets/d/" +
  //   SSID +
  //   "/gviz/tq?gid=" +
  //   master_sheet +
  //   "&tq=" +
  //   query;

  // jsonp(url, function (json_data) {
  //   // console.log(url);
  //   // console.log(json_data);
  //   if (typeof json_data.table.rows[0] === "undefined") {
  //     // TODO: Add error proccessing
  //     console.log('"' + iname + '" was not found in database.');
  //   } else {
  //     // var rarity = json_data.table.rows[0].c[1].v;
  //     var faction = "Shop";
  //     if (json_data.table.rows[0].c[2] != null) {
  //       faction = json_data.table.rows[0].c[2].v;
  //     }
  //     var category = json_data.table.rows[0].c[3].v;
  //     // var type = json_data.table.rows[0].c[4].v;
  //     var id = json_data.table.rows[0].c[5].v;
  //     document.getElementById("category").value = category;
  //     document.getElementById("faction").value = faction;
  //     document.getElementById("id").value = id;
  //   }
  // });
  appendOCR_results(data.text);
}

function locatePS(data, cimg) {
  for (let l in data.lines) {
    var txt = data.lines[l].text.trim();
    if (txt.length > 0) {
      var match = /power score/i.exec(txt);
      if (match != null) {
        cimg.sy = data.lines[l].bbox.y0 - 5;
        cimg.sh = data.lines[l].bbox.y1 - data.lines[l].bbox.y0 + 5;
        var ps = txt.substr(0, match.index).trim();
        document.getElementById("ps").value = ps.replace(/[^-\d]/g, "");
        break;
      }
    }
  }

  drawOCR(cnv_filter, "cnv_ocr", cimg);
}

function processDescOCR(data, cimg) {
  var desc = "";
  for (let l in data.lines) {
    var txt = data.lines[l].text.trim();
    if (txt.length > 0) {
      for (let j = 0; j < spellchk.length; j++) {
        txt = txt.replace(spellchk[j][0], spellchk[j][1]);
      }
      if (txt.match("Increases vehicle durability")) {
        addField(
          "form_stats",
          "increases_durability",
          "number",
          "Increases vehicle durability"
        );
        var txtsplit = txt.split(" ");
        var val = txtsplit[txtsplit.length - 1].replace(/[^-\d]/g, "");
        document.getElementById("increases_durability").value = val;
      } else if (txt.match("Increases reputation gain")) {
        addField(
          "form_stats",
          "increases_reputation",
          "number",
          "Increases reputation gain"
        );
        var txtsplit = txt.split(" ");
        var val = txtsplit[txtsplit.length - 1].replace(/[^-\d]/g, "");
        document.getElementById("increases_reputation").value = val;
      } else if (txt.match("Top speed")) {
        addField(
          "form_stats",
          "top_speed",
          "number",
          "Top speed"
        );
        var txtsplit = txt.split(" ");
        var val = txtsplit[3].replace(/[^-\d]/g, "");
        document.getElementById("top_speed").value = val;
      } else if (
        !txt.match("Not tradable") &&
        !txt.match("Does not take up storage space") &&
        !txt.match("Non-salvageable") &&
        !txt.match("Not for fusion") &&
        !txt.match("mounted on a vehicle")
      ) {
        if (desc != "") {
          desc = desc + "\n";
        }
        desc = desc + txt;
      }
    }
  }
  document.getElementById("desc").textContent = desc;

  appendOCR_results(data.text);
  drawOCR(cnv_inv, "cnv_ocr", cimg);
}

function processStatsOCR(data, cimg) {
  var featuresLine = 0;
  var durabilityLine = 0;
  var massLine = 0;
  try {
    for (let l in data.lines) {
      var txt = data.lines[l].text.trim();
      if (txt.length > 0) {
        var txtlc = txt.toLowerCase();
        for (let j = 0; j < spellchk.length; j++) {
          txtlc = txtlc.replace(spellchk[j][0], spellchk[j][1]);
        }
        var name = txtlc.split(" ")[0];
        var label = "";
        var type = "";
        switch (name) {
          case "damage":
            label = "Damage";
            type = "bar";
            break;
          case "fire":
            if (txtlc.startsWith("fire rate")) {
              name = "fire_rate";
              label = "Fire rate";
              type = "bar";
            }
            break;
          case "range":
            label = "Range";
            type = "bar";
            break;
          case "accuracy":
            label = "Accuracy";
            type = "bar";
            break;
          case "time":
            if (txtlc.startsWith("time to overheating")) {
              name = "time_to_overheating";
              label = "Time to overheating";
              type = "bar";
            }
            break;
          case "max":
            if (txtlc.startsWith("max ammo")) {
              name = "max_ammo";
              label = "Max ammo";
              type = "text";
            }
            break;
          case "blast":
            if (txtlc.startsWith("blast power")) {
              name = "blast_power";
              label = "Blast power";
              type = "bar";
            }
            break;
          case "adds":
            if (txtlc.startsWith("adds energy")) {
              name = "adds_energy";
              label = "Adds energy";
              type = "text";
            }
            break;
          case "tonnage":
            label = "Tonnage";
            type = "text";
            break;
          case "mass":
            if (txtlc.startsWith("mass limit")) {
              name = "mass_limit";
              label = "Mass limit";
              type = "text";
            } else {
              label = "Mass";
              type = "text";
              massLine = data.lines[l];
            }
            break;
          case "max.":
            if (txtlc.startsWith("max. cabin speed")) {
              name = "max_cabin_speed";
              label = "Max. cabin speed";
              type = "text";
            } else if (txtlc.startsWith("max. chassis speed")) {
              name = "max_chassis_speed";
              label = "Max. chassis speed";
              type = "text";
            }
            break;
          case "power":
            if (document.getElementById("type").value.match(/cabin/i)) {
              name = "cabin_power";
              label = "Cabin Power";
              type = "bar";
            } else {
              name = "power";
              label = "Power";
              type = "text";
            }
            break;
          case "fuel":
            if (txtlc.startsWith("fuel reserves")) {
              name = "fuel_reserves";
              label = "Fuel reserves";
              type = "text";
            }
            break;
          case "durability":
            label = "Durability";
            type = "text";
            cimg.sx2 = ~~(iw * 0.53);
            cimg.sw2 = ~~(iw * 0.3);
            cimg.sh2 = 16;
            durabilityLine = data.lines[l];
            break;
          case "energy":
            if (txtlc.startsWith("energy drain")) {
              name = "energy_drain";
              label = "Energy drain";
              type = "text";
            }
            break;

          default:
        }
        if (name == "features") {
          featuresLine = data.lines[l];
        } else if (label != "" && type != "") {
          processStatsVal(data.lines[l], cimg, name, label, type);
        } else {
          addAlert('"' + name + '" is not a known stat.\nDetected text: ' + data.lines[l].text);
          //TODO: Add error proccessing if Stat not found
        }
      }
      if (massLine != 0) {
        break;
      }
    }
    if (featuresLine != 0) {
      label = "Feature";
      type = "feature";
      processFeatures(featuresLine, durabilityLine, cimg, name, label, type);
    }
    if (cimg.sh - massLine.bbox.y1 > 50) {
      cimgs.perks.sy = massLine.bbox.y1 + cimg.sy + ~~(iw * 0.05);
      cimgs.perks.sh = ih - cimgs.perks.sy;
      processPerks(massLine, cimgs.perks, "perks", "", "");
      cimg.sh = cimgs.perks.sy - cimg.sy;
    }
    appendOCR_results(data.text);
    drawOCR(cnv_inv, "cnv_ocr", cimg);
  } catch (err) {
    console.error(err.stack);
    // TODO: Add error proccessing
  }
}

async function processStatsVal(line, cimg, name, label, type) {
  var bb = line.bbox;
  var x = cimg.sx2;
  var y = bb.y0 - cimg.sh2 + cimg.sy;
  var w = cimg.sw2;
  var h = bb.y1 - bb.y0 + cimg.sh2 * 2;
  var dx = ~~(x * proportion);
  var dy = ~~(y * proportion);
  var dw = ~~(w * proportion);
  var dh = ~~(h * proportion);
  var syc = ~~(y + h / 2); //source center of bar
  var cnv = document.getElementById("cnv_ocr");
  var ctx = cnv.getContext("2d");

  if (type == "bar") {
    addField("form_stats", name, "number", label);
    var val = processBar(ctx_inv.getImageData(x, syc, w, 1));
    document.getElementById(name).value = val;
    ctx.drawImage(cnv_inv, x, y, w, h, dx, dy, dw, dh);
  } else {
    addField("form_stats", name, "number", label);
    await recognizeFile(ctx_filter.getImageData(x, y, w, h)).then(
      (data) =>
        (document.getElementById(name).value = data.text.replace(/[^-\d]/g, "")) //.match(/-?\d+/g))
      //TODO: Add error proccessing if data.text is not a number
    );
    ctx.drawImage(cnv_filter, x, y, w, h, dx, dy, dw, dh);
  }
}

async function processFeatures(startLine, endLine, cimg, name, label, type) {
  var x = ~~(iw * 0.47);
  var y = startLine.bbox.y0 - 25 + cimg.sy;
  var w = ~~(iw * 0.49);
  var h = endLine.bbox.y0 - y - 55 + cimg.sy;
  var dx = ~~(x * proportion);
  var dy = ~~(y * proportion);
  var dw = ~~(w * proportion);
  var dh = ~~(h * proportion);

  var cnvf = document.createElement("canvas");
  var ctxf = cnvf.getContext("2d");
  cnvf.width = w;
  cnvf.height = h;
  ctxf.drawImage(cnv_inv, x, y, w, h, 0, 0, w, h);
  for (let i in featureImgs) {
    var result = detectFeatures(cnvf, featureImgs[i]);
    // console.log(i + ": " + result.maxLoc.x + ", " + result.maxLoc.y);
    if (result.maxVal > 0.9) {
      var fx = result.maxLoc.x + 65;
      var fy = result.maxLoc.y;
      var fw = 150;
      var fh = 75;
      addField("form_stats", i, "text", i);
      await recognizeFile(ctxf.getImageData(fx, fy, fw, fh)).then(
        (data) =>
          (document.getElementById(i).value = data.text.replace(/[^-\d]/g, "")) //.match(/-?\d+/g))
      );
      var container = document.getElementById("test_results");
      var fcnv = document.createElement("canvas");
      var fctx = fcnv.getContext("2d");
      fcnv.width = fw;
      fcnv.height = fh;
      fctx.drawImage(cnvf, fx, fy, fw, fh, 0, 0, fw, fh);
      container.appendChild(fcnv);
    }
  }

  var cnv = document.getElementById("cnv_ocr");
  var ctx = cnv.getContext("2d");
  ctx.drawImage(cnv_inv, x, y, w, h, dx, dy, dw, dh);
}

async function processPerks(line, cimg, name, label, type) {
  addField("form_perks", name, "textarea", label);
  await recognizeFile(ctx_inv.getImageData(cimg.sx, cimg.sy, cimg.sw, cimg.sh)).then(
    (data) => (document.getElementById(name).value = data.text.trim())
  );

  drawOCR(cnv_inv, "cnv_ocr", cimg);
}

function addField(parent, name, type, label) {
  var container = document.getElementById(parent);
  if (type == "text" || type == "number") {
    var ig = container.appendChild(document.createElement("div"));
    ig.className = "input-group mb-3";
    var igp = ig.appendChild(document.createElement("div"));
    igp.className = "input-group-prepend";
    var span = igp.appendChild(document.createElement("span"));
    span.className = "input-group-text";
    span.textContent = label;
    var input = ig.appendChild(document.createElement("input"));
    input.id = name;
    input.name = name;
    input.type = type;
    input.step = "0.1";
    input.className = "form-control";
  } else {
    var input = container.appendChild(document.createElement("textarea"));
    input.id = name;
    input.name = name;
    input.cols = "50";
    input.rows = "4";
    input.className = "form-control form-control-sm";
  }
}

function addAlert(txt) {
  var container = document.getElementById("alerts");
  var pre = container.appendChild(document.createElement("pre"));
  pre.innerText = txt;
}

function getColor(img) {
  var colors = {};
  var rgb = { r: 0, g: 0, b: 0, h: "" };
  var count = 0;
  for (var x = 0; x < img.width; x++) {
    for (var y = 0; y < img.height; y++) {
      var i = y * 4 * img.width + x * 4;
      var hex = rgbToHex(img.data[i], img.data[i + 1], img.data[i + 2]);
      rgb.r += img.data[i];
      rgb.g += img.data[i + 1];
      rgb.b += img.data[i + 2];
      count++;
      colors[hex] = (colors[hex] || 0) + 1;
    }
  }
  rgb.r = Math.floor(rgb.r / count);
  rgb.g = Math.floor(rgb.g / count);
  rgb.b = Math.floor(rgb.b / count);
  rgb.h = rgbToHex(rgb.r, rgb.g, rgb.b);
  return rgb;
}

function getRarity(rgb) {
  var rarities = [
    { r: 101, g: 101, b: 101, h: "#656565", rarity: "Base" },
    { r: 165, g: 165, b: 165, h: "#a5a5a5", rarity: "Common" },
    { r: 2, g: 74, b: 148, h: "#024a94", rarity: "Rare" },
    { r: 36, g: 147, b: 147, h: "#249393", rarity: "Special" },
    { r: 121, g: 0, b: 167, h: "#7900a7", rarity: "Epic" },
    { r: 167, g: 105, b: 42, h: "#a7692a", rarity: "Legendary" },
    { r: 163, g: 65, b: 0, h: "#a34100", rarity: "Relic" },
  ];
  for (var cbt in rarities) {
    if (rgb.r > rarities[cbt].r - 20 && rgb.r < rarities[cbt].r + 20) {
      if (rgb.g > rarities[cbt].g - 20 && rgb.g < rarities[cbt].g + 20) {
        if (rgb.b > rarities[cbt].b - 20 && rgb.b < rarities[cbt].b + 20) {
          return rarities[cbt].rarity;
        }
      }
    }
  }
  return "Unknown";
}

function processBar(img) {
  var colors = {
    "#000000": 0,
    "#b3b3b3": 0,
  };
  for (var x = 0; x < img.width; x++) {
    for (var y = 0; y < img.height; y++) {
      var i = y * 4 * img.width + x * 4;
      var hex = rgbToHex(img.data[i], img.data[i + 1], img.data[i + 2]);
      colors[hex] = (colors[hex] || 0) + 1;
    }
  }
  var val = colors["#000000"] / (colors["#000000"] + colors["#b3b3b3"]);
  val = ~~(val * 100);
  val = val / 10;
  return val;
}

function rgbToHex(r, g, b) {
  return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
}

img_org.onload = function () {
  var scale = ideal_iw / img_org.width;

  // cnv_org.width = iw;
  // cnv_org.height = ih;
  // ctx_org.drawImage(img_org, 0, 0, iw, ih);
  cv.imshow(cnv_org, scaleImage(img_org, scale));
  if (max_cw > 0) {
    iw = cnv_org.width;
    ih = cnv_org.height;
    proportion = max_cw / iw;
    cw = max_cw;
    ch = ~~(ih * proportion);
  } else {
    iw = img_org.width;
    ih = img_org.height;
    cw = ~~(iw * proportion);
    ch = ~~(ih * proportion);
  }

  // console.log('iw: %s, ih: %s, cw: %s, ch: %s', iw, ih, cw, ch);

  update_cimgs();
  initForm();

  cnv0.width = cw;
  cnv0.height = ch;
  cnv0.style.backgroundImage = "url(" + cnv_org.toDataURL() + ")";

  cnv_ocr.width = cw;
  cnv_ocr.height = ch;

  title_color = getColor(ctx_org.getImageData(10, 10, 10, 10));
  var title_gs = ~~((title_color.r + title_color.g + title_color.b) / 3);
  document.getElementById("rarity").value = getRarity(title_color);

  cnv_inv.width = iw;
  cnv_inv.height = ih;
  ctx_inv.filter = "invert(1)";
  ctx_inv.drawImage(cnv_org, 0, 0, iw, ih);

  cnv_filter.width = iw;
  cnv_filter.height = ih;
  cv.imshow(cnv_filter, filterImg(cnv_inv, 255 - title_gs + 20));

  cnv_title.width = cimgs.title.sw;
  cnv_title.height = cimgs.title.sh;
  ctx_title.filter = "invert(1)";
  ctx_title.drawImage(
    cnv_org,
    cimgs.title.sx,
    cimgs.title.sy,
    cimgs.title.sw,
    cimgs.title.sh,
    0,
    0,
    cimgs.title.sw,
    cimgs.title.sh
  );
  cv.imshow(cnv_title, filterImg(cnv_title, title_gs));
  ctx_ocr.drawImage(
    cnv_title,
    0,
    0,
    cimgs.title.sw,
    cimgs.title.sh,
    cimgs.title.dx,
    cimgs.title.dy,
    cimgs.title.dw,
    cimgs.title.dh
  );

  ocrImage();
};

function scaleImage(img, scale) {
  let src = cv.imread(img);
  let dst = new cv.Mat();
  let dsize = new cv.Size(0, 0);
  let interpolation = cv.INTER_CUBIC;
  if (scale < 1) {
    interpolation = cv.INTER_AREA;
  }
  cv.resize(src, dst, dsize, scale, scale, interpolation);
  src.delete();
  return dst;
}

function filterImg(img, thresh) {
  let src = cv.imread(img);
  let gs = new cv.Mat();
  let bw = new cv.Mat();
  let blur = new cv.Mat();
  let dst = new cv.Mat();
  let M = cv.Mat.ones(2, 2, cv.CV_8U);
  let anchor = new cv.Point(-1, -1);

  cv.cvtColor(src, gs, cv.COLOR_RGBA2GRAY);
  cv.erode(
    gs,
    blur,
    M,
    anchor,
    1,
    cv.BORDER_CONSTANT,
    cv.morphologyDefaultBorderValue()
  );
  cv.threshold(blur, dst, thresh, 255, cv.THRESH_BINARY);

  src.delete();
  gs.delete();
  bw.delete();
  blur.delete();
  return dst;
}

function recognizeImage(image) {
  //console.log('recognize START');

  ocr_info.textContent = "Waiting to start.";
  ocr_info.classList.remove("error");
  ocr_info.classList.add("processing");

  return Tesseract.recognize(image, { lang: "eng" })
    .progress((progress) => {
      // console.log('progress', progress);
      ocr_info.innerHTML = `Processing...<br>Status: ${
        progress.status
      }<br>${Math.round(progress.progress * 100)}%`;
    })
    .then((result) => {
      //console.log('result', result.text);

      ocr_info.classList.remove("processing");
      //ocr_results.textContent = result.text;
    })
    .catch((err) => {
      myError(err, "caught error");
      ocr_info.classList.add("error");
      ocr_info.textContent = "Error processing image.";
    })
    .finally(() => {
      //console.log('recognize END');
    });
}

function progressUpdate(packet) {
  var log = document.getElementById("log");

  if (log.firstChild && log.firstChild.status === packet.status) {
    if ("progress" in packet) {
      var progress = log.firstChild.querySelector("progress");
      progress.value = packet.progress;
    }
  } else {
    var line = document.createElement("div");
    line.status = packet.status;
    var status = document.createElement("div");
    status.className = "status";
    status.appendChild(document.createTextNode(packet.status));
    line.appendChild(status);

    if ("progress" in packet) {
      var progress = document.createElement("progress");
      progress.value = packet.progress;
      progress.max = 1;
      line.appendChild(progress);
    }

    if (packet.status == "done") {
      var pre = document.createElement("pre");
      pre.appendChild(document.createTextNode(packet.data.text));
      line.innerHTML = "";
      line.appendChild(pre);
    }

    log.insertBefore(line, log.firstChild);
  }
}

async function recognizeFile(file) {
  //document.querySelector("#log").innerHTML = "";

  const lang = document.querySelector("#langsel").value;
  const data = await Tesseract.recognize(file, lang, {
    logger: progressUpdate,
  });
  progressUpdate({ status: "done", data });
  return data;
}

const submitURL =
  "https://script.google.com/macros/s/AKfycbxDJYFwbtzEF9Xarhi4P6G34FQS4dRdCGiWSshXYjYjF6MylxssyqL2dFRvi2JUziG0/exec";
form.addEventListener("submit", (e) => {
  e.preventDefault();
  fetch(submitURL, {
    method: "POST",
    body: new FormData(form),
  })
    .then((response) => console.log("Success!", response))
    .then((html) => {
      // you can put any JS code here
      // alert("Success!");
    });
});

function appendOCR_results(text) {
  var pre = document.createElement("pre");
  pre.appendChild(document.createTextNode(text));
  document.getElementById("ocr_results").appendChild(pre);
}

function initForm() {
  var category = document.getElementById("category").value;
  var faction = document.getElementById("faction").value;
  var lvl = document.getElementById("level").value;

  ctx0.clearRect(0, 0, cw, ch);
  ctx_ocr.clearRect(0, 0, cw, ch);

  document.getElementById("form").reset();

  document.getElementById("desc").textContent = "";
  document.getElementById("form_stats").innerHTML = "";
  document.getElementById("form_perks").innerHTML = "";
  document.getElementById("ocr_results").innerHTML = "";
  document.getElementById("test_results").innerHTML = "";

  // var stats = document.getElementById("form_stats");
  // while (stats.hasChildNodes()) {
  //   stats.removeChild(stats.lastChild);
  // }
  // var perks = document.getElementById("form_perks");
  // while (perks.hasChildNodes()) {
  //   perks.removeChild(perks.lastChild);
  // }

  document.getElementById("category").value = category;
  document.getElementById("faction").value = faction;
  document.getElementById("level").value = lvl;
}

function myError(err, message) {
  console.warn(`MyError: ${message || ""}`);
  console.error(err);
}

function jsonp(url, callback) {
  var callbackName = "jsonp_callback_" + Math.round(100000 * Math.random());
  window[callbackName] = function (data) {
    delete window[callbackName];
    document.body.removeChild(script);
    callback(data);
  };

  var script = document.createElement("script");
  script.src = url + "&tqx=responseHandler:" + callbackName;
  // url + (url.indexOf("?") >= 0 ? "&" : "?") + "callback=" + callbackName;
  document.body.appendChild(script);
}

function detectFeatures(img, trg) {
  let src = cv.imread(img);
  let templ = cv.imread(trg);
  let dst = new cv.Mat();
  let mask = new cv.Mat();
  cv.matchTemplate(src, templ, dst, cv.TM_CCOEFF_NORMED, mask);
  let result = cv.minMaxLoc(dst, mask);
  if (result.maxVal > 0.9) {
    let maxPoint = result.maxLoc;
    let color = new cv.Scalar(255, 0, 0, 255);
    let point = new cv.Point(maxPoint.x + templ.cols, maxPoint.y + templ.rows);
    cv.rectangle(src, maxPoint, point, color, 2, cv.LINE_8, 0);
    var container = document.getElementById("test_results");
    var cnv = document.createElement("canvas");
    container.appendChild(cnv);
    cv.imshow(cnv, src);
  }
  src.delete();
  dst.delete();
  mask.delete();

  return result;
}

var getJSON = function (url, callback) {
  var xhr = new XMLHttpRequest();
  xhr.open("GET", url, true);
  xhr.responseType = "json";

  xhr.onload = function () {
    var status = xhr.status;

    if (status == 200) {
      callback(null, xhr.response);
    } else {
      callback(status);
    }
  };

  xhr.send();
};

$(document).ready(function() {
  validate();
  $('input').on('focusout', validate);
  $('select').on('focusout', validate);
  $('textarea').on('focusout', validate);
});

function validate() {
  var formInvalid = false;
  

  // get all input fields except for type='submit'
  var formInputs = $("input[name]");

  formInputs.each(function(e) {
    // if it has a value, increment the counter
    // console.log($(this)[0]);
    if ($(this).val()) {
      $(this)[0].classList.remove("invalid");
    } else {
      $(this)[0].classList.add("invalid");
      formInvalid = true;
    }
  });

  // get all input fields except for type='submit'
  var formSelects = $("select[name]");

  formSelects.each(function(e) {
    // if it has a value, increment the counter
    if ($(this).val() != 'Choose...') {
      $(this)[0].classList.remove("invalid");
    } else {
      $(this)[0].classList.add("invalid");
      formInvalid = true;
    }
  });

  // get all input fields except for type='submit'
  var formTextAreas = $("textarea[name]");

  formTextAreas.each(function(e) {
    // if it has a value, increment the counter
    if ($(this).val()) {
      $(this)[0].classList.remove("invalid");
    } else {
      $(this)[0].classList.add("invalid");
      formInvalid = true;
    }
  });

  if (formInvalid) {
    $("button[type=submit]").prop("disabled", true);
  } else {
    $("button[type=submit]").prop("disabled", false);
  }
}
